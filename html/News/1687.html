<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>C#&nbsp;socket&nbsp;多线程多管道可断点传送大文件_Winform/客户端程序_夜鹰教程网 </title>
    <meta name="keywords" content="夜鹰教程网 承接业务：软件开发 网站开发 网页设计 移动互联网app开发 asp.net+C#+vs2008/vs2010/vs2012/vs2015+MSsql2005/2008+Jquery+3G移动互联网解决方案" />
    <meta name="description" content="C#&nbsp;socket&nbsp;多线程多管道可断点传送大文件" />
    <meta name="author" content="夜鹰教程网" />
    <meta name="Copyright" content="www.yyjcw.com " />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <link href="/css/Common20121012.css" rel="stylesheet" type="text/css" />
    <link href="/css/NewsView20121012.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" language="javascript" src="/js/tangyan.js"></script>
    <script type="text/javascript" language="javascript" src="/js/jquery-1.7.1.min.js"></script>
</head>
<body>
    <form name="aspnetForm" method="post" id="aspnetForm">
  <div class="outcontainer"><div class="incontainner" style="background-image:url(/images/TopDate.gif); border:solid 1px #ccc; border-top:0; border-bottom:0; "><div id="topleft">&nbsp;本站业务范围：1、PC端软件开发、网站开发 2、移动端APP、网站、微信接口、微商城开发 3、视频教程、毕业设计辅导</div> <div id="topright">·<a href="javascript:void(0);" onclick="setHomepage('http://www.yyjcw.com');return false;">设为首页</a>·<a href="javascript:void(0);" onclick="addCookie('夜鹰教程网欢迎您!','http://www.yyjcw.com');return false;">加入收藏</a>&nbsp;<span id="now"></span>&nbsp;<a href="/xml/rss.xml" target="_blank"><img src="/images/rss.gif" alt="" style="border: 0;" /></a>&nbsp;</div></div></div>
<div class="outcontainer"><div class="incontainner" style=" background-image:url(/images/logoinline.gif); background-repeat:repeat-x;border:solid 1px #ccc;background-position:0 -7px; "><img src="/images/linklogo.gif" alt="" /><div id="nav"><p><a href="/index.html">本站首页</a><a href="/list.html">优惠活动</a><a href="/html/News/AboutUs_5.html">技术辅导</a><a href="/html/News/AboutUs_4.html">网站开发</a><a href="/ac/cloud/" style="">教程介绍</a><a target="_blank" href="/ac/vip/">尊贵服务</a><a href="/html/News/NewsList_2_1.html">技术文章</a><a target="_blank" href="/tuangou.html">最新活动</a><a target="_blank" href="/ac/tx/xuyuanqiang/">最新评论</a><a href="/mulu.html">教程目录</a><a target="_blank" href="/ac/piclist/">视频截图</a><a target="_blank" href="/ac/lucky/">在线抽奖</a></p></div><div id="buyvideo">你好，欢迎来到夜鹰网！【<a href="http://www.yyjcw.com/tuangou.html" target="_blank">去购买教程</a>】</div></div></div>
<div class="outcontainer" style="border: solid 1px white;border-left:0;border-right: 0;">
<div class="incontainner" id="search" >
<div style="clear:both;position:relative;"><div class="topNotice"><ul><li><a href="/html/News/1461.html">《夜鹰教程网sql2008视频教程》后记：任何企业都有很多的数据需要处理,学习数据库知识，提高数据处理能力，势在必行，志在必得。</a></li><li><a href="/html/News/1409.html">《原创OA视频教程》火热销售中技术不等人，发了工资就来买教程 ^_^!</a></li><li><a href="/html/News/1317.html">《asp.net+sql server制作信息发布系统》 个性签名：配角？不做！助理？不做！要做就做买得起房，开得起车，拒绝裸婚的新好青年！</a></li><li><a href="/html/News/1334.html">Asp.net培训教程视频【C#版】 举一反三，发散思维，逆水行舟，不进则退。</a></li><li><a href="/html/News/1342.html">《Asp.Net+Sql Server制作企业网站》视频教程,我们在这里等您。</a></li><li><a href="/html/News/1396.html">《Asp.Net制作带购物车的电子商务网站》尊贵服务，从夜鹰教程开始。</a></li><li><a href="/html/News/1364.html">视频教程《C#语法基础视频教程》最直接的视频教程，开门见山的视频教程。</a></li><li><a href="/html/News/1397.html">《Asp.net编程技巧范例大全》 熟能生巧，提高效率，要讲技巧。</a></li><li><a href="/html/News/1420.html">夜鹰教程网前端开发视频教程 注重用户体验，改善用户体验，提高性能，改善性能，优化结构。 </a></li><li><a href="/html/News/1454.html">【强烈推荐】jquery基础视频教程，做得多，写得少。do more,write less!兼容性好，效率高，各种特效，插件多。</a></li><li><a href="/html/News/1338.html">Asp.net+sql制作留言板</a></li><li><a href="/html/News/1331.html">《Asp.net+sql制作音乐网站》FLASH与asp.net通讯，xml作为桥梁</a></li></ul></div><a href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d"; target="_blank" onclick="var tempSrc='http://sighttp.qq.com/wpa.js?rantime='+Math.random()+'&sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d';var oldscript=document.getElementById('testJs');var newscript=document.createElement('script');newscript.setAttribute('type','text/javascript'); newscript.setAttribute('id', 'testJs');newscript.setAttribute('src',tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;" style=" display:inline; clear:both;  right:3px; position:absolute; line-height:22px;top:3px; background-color:White; border:solid 1px green; ">&nbsp;购买教程&nbsp;QQ:1416759661&nbsp;<img border="0" SRC='http://wpa.qq.com/pa?p=1:1416759661:10' alt="购买教程" align="absmiddle">&nbsp;</a></div>
</div>
</div>
<div class="outcontainer">
<div class="incontainner">
<a href="/tuangou.html"><img src="/images/03.jpg" alt="" style=" width:987px; margin-top:2px;"/></a>
<div style=" clear:both;"></div>
</div>
</div>
<table id="nei_body" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <table cellspacing="0" cellpadding="0" id="nei_tbtitle">
                    <tr>
                        <td colspan="2" align="left" valign="middle" class="nei_title">
                            &nbsp;<img src="/images/greendiamond.gif" alt="" />当前位置：<a href="/html/News/NewsList_0_1.html" target="_blank">文章中心</a> &gt;&gt; Winform/客户端程序
                        </td>
                    </tr>
                </table>
                <table align="center" cellpadding="0" cellspacing="0" id="nei_tbcenter">
                    <tr>
                        <td class="tdboder_ccc" id="nei_content_left">
                            <table class="tb_title">
                                <tr>
                                    <td id="td_title">
                                        C# socket 多线程多管道可断点传送大文件
                                    </td>
                                </tr>
                                <tr>
                                    <td id="td_date">
                                        <a href="http://www.yyjcw.com" target="_blank" title="最便宜的网站建设_视频教程_FLASH__ASP_ASP.NET_SQL2000_SQL2005_AJAX_FLEX_3ds max_Photoshop cs4_夜鹰教程网_www.yyjcw.com">夜鹰教程网</a> 来源：www.yyjcw.com 日期：2015/11/17 10:20:54
          
<div id="ckepop" style="float:right;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_tqq"></a>
<a class="jiathis_button_renren"></a>
<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
	siteNum:10,
	sm:"tsina,tqq,t163,douban,tsohu,xiaoyou,tianya,hi,renren,copy",
	summary:"",
	boldNum:6,
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
           </td>
                                </tr>
                            </table>
                            <table class="tb_title">
                                <tr>
                                    <td class="td_brief" style="border: solid 1px #ccc; width: 100%;">
                                        C#&nbsp;socket&nbsp;多线程多管道可断点传送大文件
                                    </td>
                                </tr>
                            </table>
                            <table class="tb_title">
                                <tr>
                                    <td class="td_brief" style="border: solid 1px #ccc; width: 100%;">
                                        <p><img src="/images/2Code.jpg" style="float:right;"/></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">计算机技术辅导。</span></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">QQ：1416759661 &nbsp; 新手求救QQ群：7835003</span></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果您遇到技术难题，</span><span style="color: rgb(192, 80, 77); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">需要远程调试都可以加我们QQ</span></p><p>技术咨询： <a target="_blank" href="http://www.taobao.com/webww/ww.php?ver=3&touid=%E5%A4%9C%E9%B9%B0%E9%97%AA%E5%AE%A2%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B%E7%BD%91&siteid=cntaobao&status=1&charset=utf-8"><img border="0" src="http://amos.alicdn.com/realonline.aw?v=2&uid=%E5%A4%9C%E9%B9%B0%E9%97%AA%E5%AE%A2%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B%E7%BD%91&site=cntaobao&s=1&charset=utf-8" alt="购买教程"/></a>
 &nbsp;技术咨询：<a href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d" target="_blank" onclick="var tempSrc=&#39;http://sighttp.qq.com/wpa.js?rantime=&#39;+Math.random()+&#39;&amp;sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d&#39;;var oldscript=document.getElementById(&#39;testJs&#39;);var newscript=document.createElement(&#39;script&#39;);newscript.setAttribute(&#39;type&#39;,&#39;text/javascript&#39;); newscript.setAttribute(&#39;id&#39;, &#39;testJs&#39;);newscript.setAttribute(&#39;src&#39;,tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;"><img border="0" src="http://wpa.qq.com/pa?p=1:1416759661:10" alt="购买教程"/></a></p>
                                    </td>
                                </tr>
                            </table>
                            <table class="tb_title">
                                <tr>
                                    <td id="td_content">
                                        <p>这里只发布核心代码。源码及测试程序请点这里下载，谢谢。</p><p>有啥BUG，问题请发送email至ilovehaley.kid@gmail.com ，谢谢。:D</p><p>&nbsp;</p><pre><p><span style="color: #008080;"> &nbsp;1</span> <span style="color: #0000ff;">#define</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> &nbsp;2</span> <span style="color: #000000;">&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">#undef Sleep<br/></span><span style="color: #008080;"> &nbsp;3</span> <span style="color: #008000;">&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">#define TransmitLog</span><span style="color: #008000;"><br/></span><span style="color: #008080;"> &nbsp;4</span> <span style="color: #008000;">&nbsp;</span><span style="color: #0000ff;">#undef</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> &nbsp;5</span> <span style="color: #000000;">&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">#define BreakpointLog</span><span style="color: #008000;"><br/></span><span style="color: #008080;"> &nbsp;6</span> <span style="color: #008000;">&nbsp;</span><span style="color: #0000ff;">#undef</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> &nbsp;7</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br/></span><span style="color: #008080;"> &nbsp;8</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Net;<br/></span><span style="color: #008080;"> &nbsp;9</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Net.Sockets;<br/></span><span style="color: #008080;"> 10</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.IO;<br/></span><span style="color: #008080;"> 11</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br/></span><span style="color: #008080;"> 12</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Threading;<br/></span><span style="color: #008080;"> 13</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br/></span><span style="color: #008080;"> 14</span> <span style="color: #000000;"></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Diagnostics;<br/></span><span style="color: #008080;"> 15</span> <span style="color: #000000;"><br/></span><span style="color: #008080;"> 16</span> <span style="color: #000000;"></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> Rocky<br/></span><span style="color: #008080;"> 17</span> <span style="color: #000000;">{<br/></span><span style="color: #008080;"> 18</span> <span style="color: #000000;"> &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> FileTransmiter<br/></span><span style="color: #008080;"> 19</span> <span style="color: #000000;"> &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 20</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> NestedType</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 21</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> SendWorker : IWorker<br/></span><span style="color: #008080;"> 22</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 23</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> totalSent, totalSend;<br/></span><span style="color: #008080;"> 24</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer;<br/></span><span style="color: #008080;"> 25</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Socket sock;<br/></span><span style="color: #008080;"> 26</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> FileStream reader;<br/></span><span style="color: #008080;"> 27</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Thread thread;<br/></span><span style="color: #008080;"> 28</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> isFinished;<br/></span><span style="color: #008080;"> 29</span> <span style="color: #000000;"><br/></span><span style="color: #008080;"> 30</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> TotalSent<br/></span><span style="color: #008080;"> 31</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 32</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> totalSent; }<br/></span><span style="color: #008080;"> 33</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 34</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> TotalSend<br/></span><span style="color: #008080;"> 35</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 36</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> totalSend; }<br/></span><span style="color: #008080;"> 37</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 38</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] Buffer<br/></span><span style="color: #008080;"> 39</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 40</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> buffer; }<br/></span><span style="color: #008080;"> 41</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 42</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Socket Client<br/></span><span style="color: #008080;"> 43</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 44</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> sock; }<br/></span><span style="color: #008080;"> 45</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 46</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsFinished<br/></span><span style="color: #008080;"> 47</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 48</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> isFinished; }<br/></span><span style="color: #008080;"> 49</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 50</span> <span style="color: #000000;"><br/></span><span style="color: #008080;"> 51</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> SendWorker(IPEndPoint ip)<br/></span><span style="color: #008080;"> 52</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 53</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(AddressFamily.InterNetwork, <br/> SocketType.Stream, ProtocolType.Tcp);<br/></span><span style="color: #008080;"> 54</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Connect(ip);<br/></span><span style="color: #008080;"> 55</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[BufferSize];<br/></span><span style="color: #008080;"> 56</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 57</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position, <br/> <br/></span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length)<br/></span><span style="color: #008080;"> 58</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 59</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Initialize(path, position, length, </span><span style="color: #800080;">0L</span><span style="color: #000000;">, length);<br/></span><span style="color: #008080;"> 60</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 61</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position,<br/> &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total)<br/></span><span style="color: #008080;"> 62</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 63</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reader </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.Open,<br/> &nbsp;FileAccess.Read, FileShare.Read);<br/></span><span style="color: #008080;"> 64</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reader.Position </span><span style="color: #000000;">=</span><span style="color: #000000;"> position </span><span style="color: #000000;">+</span><span style="color: #000000;"> worked;<br/></span><span style="color: #008080;"> 65</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalSent </span><span style="color: #000000;">=</span><span style="color: #000000;"> worked;<br/></span><span style="color: #008080;"> 66</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalSend </span><span style="color: #000000;">=</span><span style="color: #000000;"> total;<br/></span><span style="color: #008080;"> 67</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Thread(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ParameterizedThreadStart(Work));<br/></span><span style="color: #008080;"> 68</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.IsBackground </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;"> 69</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 70</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.Name </span><span style="color: #000000;">=</span><span style="color: #000000;"> position.ToString() </span><span style="color: #000000;">+</span><span style="color: #000000;"> length.ToString();<br/></span><span style="color: #008080;"> 71</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Transmit, thread.Name </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> <br/></span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> Initialized:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSent </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSend </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;"> 72</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 73</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 74</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Work(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> obj)<br/></span><span style="color: #008080;"> 75</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 76</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> read, sent;<br/></span><span style="color: #008080;"> 77</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> flag;<br/></span><span style="color: #008080;"> 78</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (totalSent </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> totalSend)<br/></span><span style="color: #008080;"> 79</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 80</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read </span><span style="color: #000000;">=</span><span style="color: #000000;"> reader.Read(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, Math.Min(BufferSize, <br/>(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)(totalSend </span><span style="color: #000000;">-</span><span style="color: #000000;"> totalSent)));<br/></span><span style="color: #008080;"> 81</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sent </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br/></span><span style="color: #008080;"> 82</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;"> 83</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> ((sent </span><span style="color: #000000;">+=</span><span style="color: #000000;"> sock.Send(buffer, sent, read,<br/> &nbsp;SocketFlags.None)) </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> read)<br/></span><span style="color: #008080;"> 84</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 85</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br/></span><span style="color: #008080;"> 86</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalSent </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)sent;<br/></span><span style="color: #008080;"> 87</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 88</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Transmit, thread.Name<br/> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSent </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSend </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;"> 89</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 90</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 91</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;"> 92</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 93</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;"> 94</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (flag)<br/></span><span style="color: #008080;"> 95</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;"> 96</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalSent </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)read;<br/></span><span style="color: #008080;"> 97</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;"> 98</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Transmit, thread.Name<br/> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSent </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalSend </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;"> 99</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">100</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;">101</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">102</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">103</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">104</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">105</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reader.Dispose();<br/></span><span style="color: #008080;">106</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Shutdown(SocketShutdown.Both);<br/></span><span style="color: #008080;">107</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Close();<br/></span><span style="color: #008080;">108</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EventWaitHandle waitHandle </span><span style="color: #000000;">=</span><span style="color: #000000;"> obj </span><span style="color: #0000ff;">as</span><span style="color: #000000;"> EventWaitHandle;<br/></span><span style="color: #008080;">109</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (waitHandle </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">110</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">111</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waitHandle.Set();<br/></span><span style="color: #008080;">112</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">113</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isFinished </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">114</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">115</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">116</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total)<br/></span><span style="color: #008080;">117</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">118</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worked </span><span style="color: #000000;">=</span><span style="color: #000000;"> totalSent;<br/></span><span style="color: #008080;">119</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;total </span><span style="color: #000000;">=</span><span style="color: #000000;"> totalSend;<br/></span><span style="color: #008080;">120</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">121</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">122</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> RunWork(EventWaitHandle waitHandle)<br/></span><span style="color: #008080;">123</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">124</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.Start(waitHandle);<br/></span><span style="color: #008080;">125</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">126</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">127</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">128</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> ReceiveWorker : IWorker<br/></span><span style="color: #008080;">129</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">130</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> offset, totalReceived, totalReceive;<br/></span><span style="color: #008080;">131</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer;<br/></span><span style="color: #008080;">132</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Socket sock;<br/></span><span style="color: #008080;">133</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> FileStream writer;<br/></span><span style="color: #008080;">134</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Thread thread;<br/></span><span style="color: #008080;">135</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> isFinished;<br/></span><span style="color: #008080;">136</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">137</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> TotalReceived<br/></span><span style="color: #008080;">138</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">139</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> totalReceived; }<br/></span><span style="color: #008080;">140</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">141</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> TotalReceive<br/></span><span style="color: #008080;">142</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">143</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> totalReceive; }<br/></span><span style="color: #008080;">144</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">145</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] Buffer<br/></span><span style="color: #008080;">146</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">147</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> buffer; }<br/></span><span style="color: #008080;">148</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">149</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Socket Client<br/></span><span style="color: #008080;">150</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">151</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> sock; }<br/></span><span style="color: #008080;">152</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">153</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsFinished<br/></span><span style="color: #008080;">154</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">155</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> { </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> isFinished; }<br/></span><span style="color: #008080;">156</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">157</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">158</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> ReceiveWorker(Socket client)<br/></span><span style="color: #008080;">159</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">160</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock </span><span style="color: #000000;">=</span><span style="color: #000000;"> client;<br/></span><span style="color: #008080;">161</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[BufferSize];<br/></span><span style="color: #008080;">162</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">163</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length)<br/></span><span style="color: #008080;">164</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">165</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Initialize(path, position, length, </span><span style="color: #800080;">0L</span><span style="color: #000000;">, length);<br/></span><span style="color: #008080;">166</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">167</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length,<br/> &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total)<br/></span><span style="color: #008080;">168</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">169</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.Open,<br/> &nbsp;FileAccess.Write, FileShare.Write);<br/></span><span style="color: #008080;">170</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Position </span><span style="color: #000000;">=</span><span style="color: #000000;"> position </span><span style="color: #000000;">+</span><span style="color: #000000;"> worked;<br/></span><span style="color: #008080;">171</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Lock(position, length);<br/></span><span style="color: #008080;">172</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;offset </span><span style="color: #000000;">=</span><span style="color: #000000;"> position;<br/></span><span style="color: #008080;">173</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalReceived </span><span style="color: #000000;">=</span><span style="color: #000000;"> worked;<br/></span><span style="color: #008080;">174</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalReceive </span><span style="color: #000000;">=</span><span style="color: #000000;"> total;<br/></span><span style="color: #008080;">175</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Thread(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ParameterizedThreadStart(Work));<br/></span><span style="color: #008080;">176</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.IsBackground </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">177</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">178</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.Name </span><span style="color: #000000;">=</span><span style="color: #000000;"> position.ToString() </span><span style="color: #000000;">+</span><span style="color: #000000;"> length.ToString();<br/></span><span style="color: #008080;">179</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Transmit, thread.Name <br/> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/></span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> Initialized:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalReceived </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalReceive </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">180</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">181</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">182</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Work(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> obj)<br/></span><span style="color: #008080;">183</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">184</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> received;<br/></span><span style="color: #008080;">185</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (totalReceived </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> totalReceive)<br/></span><span style="color: #008080;">186</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">187</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ((received </span><span style="color: #000000;">=</span><span style="color: #000000;"> sock.Receive(buffer)) </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">188</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">189</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">190</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">191</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, received);<br/></span><span style="color: #008080;">192</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Flush();<br/></span><span style="color: #008080;">193</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;totalReceived </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)received;<br/></span><span style="color: #008080;">194</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">195</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Transmit, thread.Name </span><span style="color: #000000;">+<br/><br/></span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalReceived </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> totalReceive </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">196</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">197</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;">198</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">199</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">200</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">201</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Unlock(offset, totalReceive);<br/></span><span style="color: #008080;">202</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Dispose();<br/></span><span style="color: #008080;">203</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Shutdown(SocketShutdown.Both);<br/></span><span style="color: #008080;">204</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Close();<br/></span><span style="color: #008080;">205</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EventWaitHandle waitHandle </span><span style="color: #000000;">=</span><span style="color: #000000;"> obj </span><span style="color: #0000ff;">as</span><span style="color: #000000;"> EventWaitHandle;<br/></span><span style="color: #008080;">206</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (waitHandle </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">207</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">208</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waitHandle.Set();<br/></span><span style="color: #008080;">209</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">210</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isFinished </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">211</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">212</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">213</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total)<br/></span><span style="color: #008080;">214</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">215</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worked </span><span style="color: #000000;">=</span><span style="color: #000000;"> totalReceived;<br/></span><span style="color: #008080;">216</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;total </span><span style="color: #000000;">=</span><span style="color: #000000;"> totalReceive;<br/></span><span style="color: #008080;">217</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">218</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">219</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> RunWork(EventWaitHandle waitHandle)<br/></span><span style="color: #008080;">220</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">221</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;thread.Start(waitHandle);<br/></span><span style="color: #008080;">222</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">223</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">224</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">225</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">interface</span><span style="color: #000000;"> IWorker<br/></span><span style="color: #008080;">226</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">227</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsFinished { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; }<br/></span><span style="color: #008080;">228</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length);<br/></span><span style="color: #008080;">229</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Initialize(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> position, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> length,<br/> &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total);<br/></span><span style="color: #008080;">230</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total);<br/></span><span style="color: #008080;">231</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> RunWork(EventWaitHandle waitHandle);<br/></span><span style="color: #008080;">232</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">233</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">234</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">235</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Field</span><span style="color: #000000;"><br/></span><span style="color: #008080;">236</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> BufferSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1024</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">237</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> PerLongCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(</span><span style="color: #0000ff;">long</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">238</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> MinThreadCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">239</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> MaxThreadCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">9</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">240</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> PointExtension </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.dat</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">241</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> TempExtension </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.temp</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">242</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> SplitSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1024L</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">1024L</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">100L</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">243</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">readonly</span><span style="color: #000000;"> IPEndPoint TestIP;<br/></span><span style="color: #008080;">244</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">245</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> StreamWriter transmitLoger;<br/></span><span style="color: #008080;">246</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">247</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">248</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> StreamWriter breakpointLoger;<br/></span><span style="color: #008080;">249</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">250</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">251</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">252</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Constructor</span><span style="color: #000000;"><br/></span><span style="color: #008080;">253</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;"> FileTransmiter()<br/></span><span style="color: #008080;">254</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">255</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppDomain.CurrentDomain.UnhandledException </span><span style="color: #000000;">+=</span><span style="color: #000000;"> <br/> <br/></span><span style="color: #0000ff;">new</span><span style="color: #000000;"> UnhandledExceptionEventHandler(CurrentDomain_UnhandledException);<br/></span><span style="color: #008080;">256</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TestIP </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> IPEndPoint(IPAddress.Parse(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">), </span><span style="color: #800080;">520</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">257</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">258</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transmitLoger </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> StreamWriter(Path.Combine(<br/> AppDomain.CurrentDomain.BaseDirectory, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">transmit.log</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">), </span><span style="color: #0000ff;">true</span><span style="color: #000000;">, Encoding.Default);<br/></span><span style="color: #008080;">259</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">260</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">261</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breakpointLoger </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> StreamWriter(Path.Combine(<br/> AppDomain.CurrentDomain.BaseDirectory, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">breakpoint.log</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">), </span><span style="color: #0000ff;">true</span><span style="color: #000000;">, Encoding.Default);<br/></span><span style="color: #008080;">262</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">263</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">264</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">265</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> CurrentDomain_UnhandledException(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender,<br/> &nbsp;UnhandledExceptionEventArgs e)<br/></span><span style="color: #008080;">266</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">267</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StreamWriter writer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> StreamWriter(Path.Combine(<br/> AppDomain.CurrentDomain.BaseDirectory, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">exec.log</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">), </span><span style="color: #0000ff;">true</span><span style="color: #000000;">, Encoding.Default);<br/></span><span style="color: #008080;">268</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Time:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">269</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(DateTime.Now.ToShortTimeString());<br/></span><span style="color: #008080;">270</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">. </span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">271</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.WriteLine(e.ExceptionObject);<br/></span><span style="color: #008080;">272</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Dispose();<br/></span><span style="color: #008080;">273</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">274</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">275</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Log</span><span style="color: #000000;"><br/></span><span style="color: #008080;">276</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog || BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">277</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">enum</span><span style="color: #000000;"> LogType<br/></span><span style="color: #008080;">278</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">279</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Transmit,<br/></span><span style="color: #008080;">280</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Breakpoint<br/></span><span style="color: #008080;">281</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">282</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">283</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> AppendTransmitLog(LogType type, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> msg)<br/></span><span style="color: #008080;">284</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">285</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (type)<br/></span><span style="color: #008080;">286</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">287</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> LogType.Transmit:<br/></span><span style="color: #008080;">288</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">289</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transmitLoger.Write(DateTime.Now.ToShortTimeString());<br/></span><span style="color: #008080;">290</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transmitLoger.Write(</span><span style="color: #800000;">&#39;</span><span style="color: #800000;">\t</span><span style="color: #800000;">&#39;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">291</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transmitLoger.WriteLine(msg);<br/></span><span style="color: #008080;">292</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transmitLoger.Flush();<br/></span><span style="color: #008080;">293</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">294</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">295</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> LogType.Breakpoint:<br/></span><span style="color: #008080;">296</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">297</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breakpointLoger.Write(DateTime.Now.ToShortTimeString());<br/></span><span style="color: #008080;">298</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breakpointLoger.Write(</span><span style="color: #800000;">&#39;</span><span style="color: #800000;">\t</span><span style="color: #800000;">&#39;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">299</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breakpointLoger.WriteLine(msg);<br/></span><span style="color: #008080;">300</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breakpointLoger.Flush();<br/></span><span style="color: #008080;">301</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">302</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">303</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">304</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">305</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">306</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">307</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">308</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">309</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Single</span><span style="color: #000000;"><br/></span><span style="color: #008080;">310</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Send(IPEndPoint ip, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path)<br/></span><span style="color: #008080;">311</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">312</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopwatch watcher </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br/></span><span style="color: #008080;">313</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Start();<br/></span><span style="color: #008080;">314</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Socket sock </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(AddressFamily.InterNetwork, <br/> SocketType.Stream, ProtocolType.Tcp);<br/></span><span style="color: #008080;">315</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Connect(ip);<br/></span><span style="color: #008080;">316</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[BufferSize];<br/></span><span style="color: #008080;">317</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (FileStream reader </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, <br/> FileMode.Open, FileAccess.Read, FileShare.None))<br/></span><span style="color: #008080;">318</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">319</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> send, length </span><span style="color: #000000;">=</span><span style="color: #000000;"> reader.Length;<br/></span><span style="color: #008080;">320</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buffer.BlockCopy(BitConverter.GetBytes(length), <br/> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/></span><span style="color: #800080;">0</span><span style="color: #000000;">, buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, PerLongCount);<br/></span><span style="color: #008080;">321</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">=</span><span style="color: #000000;"> Path.GetFileName(path);<br/></span><span style="color: #008080;">322</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Send(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, PerLongCount </span><span style="color: #000000;">+<br/><br/></span><span style="color: #000000;"> Encoding.Default.GetBytes(fileName, </span><span style="color: #800080;">0</span><span style="color: #000000;">, fileName.Length,<br/> buffer, PerLongCount), SocketFlags.None);<br/></span><span style="color: #008080;">323</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Sending file:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> fileName </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.Plz wait...</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">324</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Receive(buffer);<br/></span><span style="color: #008080;">325</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reader.Position </span><span style="color: #000000;">=</span><span style="color: #000000;"> send </span><span style="color: #000000;">=</span><span style="color: #000000;"> BitConverter.ToInt64(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">326</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">327</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Breakpoint </span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> reader.Position);<br/></span><span style="color: #008080;">328</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">329</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> read, sent;<br/></span><span style="color: #008080;">330</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> flag;<br/></span><span style="color: #008080;">331</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> ((read </span><span style="color: #000000;">=</span><span style="color: #000000;"> reader.Read(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, BufferSize)) </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">332</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">333</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sent </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">334</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">335</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> ((sent </span><span style="color: #000000;">+=</span><span style="color: #000000;"> sock.Send(buffer, sent, read, <br/> SocketFlags.None)) </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> read)<br/></span><span style="color: #008080;">336</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">337</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">338</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;send </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)sent;<br/></span><span style="color: #008080;">339</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">340</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Sent </span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> send </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> length </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">341</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">342</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;">343</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">344</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">345</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">346</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (flag)<br/></span><span style="color: #008080;">347</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">348</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;send </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)read;<br/></span><span style="color: #008080;">349</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">350</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Sent </span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> send </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> length </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">351</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">352</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;">353</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">354</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">355</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">356</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">357</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">358</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Shutdown(SocketShutdown.Both);<br/></span><span style="color: #008080;">359</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sock.Close();<br/></span><span style="color: #008080;">360</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Stop();<br/></span><span style="color: #008080;">361</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Send finish.Span Time:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"><br/> watcher.Elapsed.TotalMilliseconds </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> ms.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">362</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">363</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">364</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Receive(IPEndPoint ip, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path)<br/></span><span style="color: #008080;">365</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">366</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Socket listener </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(AddressFamily.InterNetwork,<br/> &nbsp;SocketType.Stream, ProtocolType.Tcp);<br/></span><span style="color: #008080;">367</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listener.Bind(ip);<br/></span><span style="color: #008080;">368</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listener.Listen(MinThreadCount);<br/></span><span style="color: #008080;">369</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Socket client </span><span style="color: #000000;">=</span><span style="color: #000000;"> listener.Accept();<br/></span><span style="color: #008080;">370</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopwatch watcher </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br/></span><span style="color: #008080;">371</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Start();<br/></span><span style="color: #008080;">372</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[BufferSize];<br/></span><span style="color: #008080;">373</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> received </span><span style="color: #000000;">=</span><span style="color: #000000;"> client.Receive(buffer);<br/></span><span style="color: #008080;">374</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> receive, length </span><span style="color: #000000;">=</span><span style="color: #000000;"> BitConverter.ToInt64(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">375</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">=</span><span style="color: #000000;"> Encoding.Default.GetString(buffer, <br/> PerLongCount, received </span><span style="color: #000000;">-</span><span style="color: #000000;"> PerLongCount);<br/></span><span style="color: #008080;">376</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Receiveing file:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.Plz wait...</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">377</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FileInfo file </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInfo(Path.Combine(path, fileName));<br/></span><span style="color: #008080;">378</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (FileStream writer </span><span style="color: #000000;">=</span><span style="color: #000000;"> file.Open(file.Exists </span><span style="color: #000000;">?</span><span style="color: #000000;"> <br/> FileMode.Append : FileMode.CreateNew, FileAccess.Write, FileShare.None))<br/></span><span style="color: #008080;">379</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">380</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;receive </span><span style="color: #000000;">=</span><span style="color: #000000;"> writer.Length;<br/></span><span style="color: #008080;">381</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client.Send(BitConverter.GetBytes(receive));<br/></span><span style="color: #008080;">382</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">383</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Breakpoint </span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> receive);<br/></span><span style="color: #008080;">384</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">385</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (receive </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> length)<br/></span><span style="color: #008080;">386</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">387</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ((received </span><span style="color: #000000;">=</span><span style="color: #000000;"> client.Receive(buffer)) </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">388</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">389</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Send Stop.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">390</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">391</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">392</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, received);<br/></span><span style="color: #008080;">393</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;writer.Flush();<br/></span><span style="color: #008080;">394</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;receive </span><span style="color: #000000;">+=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)received;<br/></span><span style="color: #008080;">395</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> TransmitLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">396</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Received </span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> receive </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> length </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">397</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">398</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> Sleep</span><span style="color: #000000;"><br/></span><span style="color: #008080;">399</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">400</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">401</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">402</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">403</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client.Shutdown(SocketShutdown.Both);<br/></span><span style="color: #008080;">404</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client.Close();<br/></span><span style="color: #008080;">405</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Stop();<br/></span><span style="color: #008080;">406</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Receive finish.Span Time:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> watcher.Elapsed.TotalMilliseconds </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> ms.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">407</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">408</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">409</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">410</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Supper</span><span style="color: #000000;"><br/></span><span style="color: #008080;">411</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Extensions</span><span style="color: #000000;"><br/></span><span style="color: #008080;">412</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ReportProgress(</span><span style="color: #0000ff;">this</span><span style="color: #000000;"> IWorker[] workers, <br/> <br/></span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> worked, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> total)<br/></span><span style="color: #008080;">413</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">414</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worked </span><span style="color: #000000;">=</span><span style="color: #000000;"> total </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0L</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">415</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> w, t;<br/></span><span style="color: #008080;">416</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (IWorker worker </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> workers)<br/></span><span style="color: #008080;">417</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">418</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worker.ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> w, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> t);<br/></span><span style="color: #008080;">419</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worked </span><span style="color: #000000;">+=</span><span style="color: #000000;"> w;<br/></span><span style="color: #008080;">420</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;total </span><span style="color: #000000;">+=</span><span style="color: #000000;"> t;<br/></span><span style="color: #008080;">421</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">422</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)(worked </span><span style="color: #000000;">/</span><span style="color: #000000;"> total) </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">100</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">423</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">424</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ReportSpeed(</span><span style="color: #0000ff;">this</span><span style="color: #000000;"> IWorker[] workers, </span><span style="color: #0000ff;">ref</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> oldValue)<br/></span><span style="color: #008080;">425</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">426</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> w, t;<br/></span><span style="color: #008080;">427</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers.ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> w, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> t);<br/></span><span style="color: #008080;">428</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> speed </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)((w </span><span style="color: #000000;">-</span><span style="color: #000000;"> oldValue) </span><span style="color: #000000;">/</span><span style="color: #000000;"> </span><span style="color: #800080;">8L</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">429</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oldValue </span><span style="color: #000000;">=</span><span style="color: #000000;"> w;<br/></span><span style="color: #008080;">430</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> speed;<br/></span><span style="color: #008080;">431</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">432</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsAllFinished(</span><span style="color: #0000ff;">this</span><span style="color: #000000;"> IWorker[] workers)<br/></span><span style="color: #008080;">433</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">434</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">435</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (IWorker worker </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> workers)<br/></span><span style="color: #008080;">436</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">437</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">worker.IsFinished)<br/></span><span style="color: #008080;">438</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">439</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">440</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">441</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">442</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">443</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> flag;<br/></span><span style="color: #008080;">444</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">445</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">446</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">447</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Helper</span><span style="color: #000000;"><br/></span><span style="color: #008080;">448</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Write(</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> value, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> offset)<br/></span><span style="color: #008080;">449</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">450</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)value;<br/></span><span style="color: #008080;">451</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">8</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">452</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x10</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">453</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x18</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">454</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x20</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">455</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">40</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">456</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x30</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">457</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer[offset] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)(value </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x38</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">458</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">459</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Read(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> value, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] buffer, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> offset)<br/></span><span style="color: #008080;">460</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">461</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">uint</span><span style="color: #000000;"> num </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">uint</span><span style="color: #000000;">)(((buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">|</span><span style="color: #000000;"> (buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">8</span><span style="color: #000000;">)) </span><span style="color: #000000;">|</span><span style="color: #000000;"> <br/> (buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x10</span><span style="color: #000000;">)) </span><span style="color: #000000;">|</span><span style="color: #000000;"> (buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x18</span><span style="color: #000000;">));<br/></span><span style="color: #008080;">462</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">uint</span><span style="color: #000000;"> num2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">uint</span><span style="color: #000000;">)(((buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">|</span><span style="color: #000000;"> (buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">8</span><span style="color: #000000;">)) </span><span style="color: #000000;">|</span><span style="color: #000000;"><br/> (buffer[offset</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x10</span><span style="color: #000000;">)) </span><span style="color: #000000;">|</span><span style="color: #000000;"> (buffer[offset] </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x18</span><span style="color: #000000;">));<br/></span><span style="color: #008080;">463</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;value </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)((num2 </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0x20</span><span style="color: #000000;">) </span><span style="color: #000000;">|</span><span style="color: #000000;"> num);<br/></span><span style="color: #008080;">464</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">465</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">466</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">467</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> GetThreadCount(</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> fileSize)<br/></span><span style="color: #008080;">468</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">469</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> count </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)(fileSize </span><span style="color: #000000;">/</span><span style="color: #000000;"> SplitSize);<br/></span><span style="color: #008080;">470</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (count </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> MinThreadCount)<br/></span><span style="color: #008080;">471</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">472</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;count </span><span style="color: #000000;">=</span><span style="color: #000000;"> MinThreadCount;<br/></span><span style="color: #008080;">473</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">474</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (count </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> MaxThreadCount)<br/></span><span style="color: #008080;">475</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">476</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;count </span><span style="color: #000000;">=</span><span style="color: #000000;"> MaxThreadCount;<br/></span><span style="color: #008080;">477</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">478</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> count;<br/></span><span style="color: #008080;">479</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">480</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">481</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> SupperSend(IPEndPoint ip, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path)<br/></span><span style="color: #008080;">482</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">483</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopwatch watcher </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br/></span><span style="color: #008080;">484</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Start();<br/></span><span style="color: #008080;">485</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FileInfo file </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInfo(path);<br/></span><span style="color: #008080;">486</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> DEBUG</span><span style="color: #000000;"><br/></span><span style="color: #008080;">487</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">file.Exists)<br/></span><span style="color: #008080;">488</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">489</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileNotFoundException();<br/></span><span style="color: #008080;">490</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">491</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">492</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SendWorker worker </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> SendWorker(ip);<br/></span><span style="color: #008080;">493</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">=</span><span style="color: #000000;"> file.Length;<br/></span><span style="color: #008080;">494</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buffer.BlockCopy(BitConverter.GetBytes(fileLength), </span><span style="color: #800080;">0</span><span style="color: #000000;">,<br/> worker.Buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, PerLongCount);<br/></span><span style="color: #008080;">495</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">=</span><span style="color: #000000;"> file.Name;<br/></span><span style="color: #008080;">496</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worker.Client.Send(worker.Buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">, PerLongCount </span><span style="color: #000000;">+</span><span style="color: #000000;"><br/> Encoding.Default.GetBytes(fileName, </span><span style="color: #800080;">0</span><span style="color: #000000;">, fileName.Length, worker.Buffer,<br/> PerLongCount), SocketFlags.None);<br/></span><span style="color: #008080;">497</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Sending file:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.Plz wait...</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">498</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> GetThreadCount(fileLength);<br/></span><span style="color: #008080;">499</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SendWorker[] workers </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> SendWorker[threadCount];<br/></span><span style="color: #008080;">500</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">501</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">502</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> i </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> worker : </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> SendWorker(ip);<br/></span><span style="color: #008080;">503</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">504</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Breakpoint</span><span style="color: #000000;"><br/></span><span style="color: #008080;">505</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> PerLongCount </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">, <br/>count </span><span style="color: #000000;">=</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">*</span><span style="color: #000000;"> threadCount;<br/></span><span style="color: #008080;">506</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] bufferInfo </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[count];<br/></span><span style="color: #008080;">507</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> oddSize, avgSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> Math.DivRem(fileLength, <br/> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)threadCount, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> oddSize);<br/></span><span style="color: #008080;">508</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (worker.Client.Receive(bufferInfo) </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">4</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">509</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">510</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">511</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">512</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].Initialize(path, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> avgSize, <br/> i </span><span style="color: #000000;">==</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> avgSize </span><span style="color: #000000;">+</span><span style="color: #000000;"> oddSize : avgSize);<br/></span><span style="color: #008080;">513</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">514</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">515</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br/></span><span style="color: #008080;">516</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">517</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> w, t;<br/></span><span style="color: #008080;">518</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">519</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">520</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Read(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> w, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount);<br/></span><span style="color: #008080;">521</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Read(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> t, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">+</span><span style="color: #000000;"> PerLongCount);<br/></span><span style="color: #008080;">522</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].Initialize(path, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> avgSize, <br/> i </span><span style="color: #000000;">==</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> avgSize </span><span style="color: #000000;">+</span><span style="color: #000000;"> oddSize : avgSize, w, t);<br/></span><span style="color: #008080;">523</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">524</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Breakpoint, i </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> read:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> w </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> t </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">525</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">526</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">527</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">528</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">529</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">530</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AutoResetEvent reset </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> AutoResetEvent(</span><span style="color: #0000ff;">true</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">531</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">532</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">533</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].RunWork(i </span><span style="color: #000000;">==</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> reset : </span><span style="color: #0000ff;">null</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">534</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">535</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reset.WaitOne();<br/></span><span style="color: #008080;">536</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Breakpoint</span><span style="color: #000000;"><br/></span><span style="color: #008080;">537</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> speed;<br/></span><span style="color: #008080;">538</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> value </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0L</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">539</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">do</span><span style="color: #000000;"><br/></span><span style="color: #008080;">540</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">541</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speed </span><span style="color: #000000;">=</span><span style="color: #000000;"> workers.ReportSpeed(</span><span style="color: #0000ff;">ref</span><span style="color: #000000;"> value);<br/></span><span style="color: #008080;">542</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">waiting for other threads. Progress:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> <br/> <br/></span><span style="color: #000000;">+</span><span style="color: #000000;"> value </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">;Speed:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> speed </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kb/s.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">543</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">1000</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">544</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">545</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">workers.IsAllFinished());<br/></span><span style="color: #008080;">546</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speed </span><span style="color: #000000;">=</span><span style="color: #000000;"> workers.ReportSpeed(</span><span style="color: #0000ff;">ref</span><span style="color: #000000;"> value);<br/></span><span style="color: #008080;">547</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">waiting for other threads. Progress:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> value </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">;Speed:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> speed </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kb/s.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">548</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">549</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Stop();<br/></span><span style="color: #008080;">550</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Send finish.Span Time:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> watcher.Elapsed.TotalMilliseconds </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> ms.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">551</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">552</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">553</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> SupperReceive(IPEndPoint ip, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> path)<br/></span><span style="color: #008080;">554</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">555</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Socket listener </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(AddressFamily.InterNetwork, <br/> SocketType.Stream, ProtocolType.Tcp);<br/></span><span style="color: #008080;">556</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listener.Bind(ip);<br/></span><span style="color: #008080;">557</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listener.Listen(MaxThreadCount);<br/></span><span style="color: #008080;">558</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ReceiveWorker worker </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ReceiveWorker(listener.Accept());<br/></span><span style="color: #008080;">559</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Stopwatch watcher </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br/></span><span style="color: #008080;">560</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Start();<br/></span><span style="color: #008080;">561</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> recv </span><span style="color: #000000;">=</span><span style="color: #000000;"> worker.Client.Receive(worker.Buffer);<br/></span><span style="color: #008080;">562</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">=</span><span style="color: #000000;"> BitConverter.ToInt64(worker.Buffer, </span><span style="color: #800080;">0</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">563</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">=</span><span style="color: #000000;"> Encoding.Default.GetString(worker.Buffer, <br/> PerLongCount, recv </span><span style="color: #000000;">-</span><span style="color: #000000;"> PerLongCount);<br/></span><span style="color: #008080;">564</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Receiveing file:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileName </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.Plz wait...</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">565</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> GetThreadCount(fileLength);<br/></span><span style="color: #008080;">566</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ReceiveWorker[] workers </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ReceiveWorker[threadCount];<br/></span><span style="color: #008080;">567</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">568</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">569</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> i </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> worker : </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ReceiveWorker(listener.Accept());<br/></span><span style="color: #008080;">570</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">571</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Breakpoint</span><span style="color: #000000;"><br/></span><span style="color: #008080;">572</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> PerLongCount </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">, count </span><span style="color: #000000;">=</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">*</span><span style="color: #000000;"> threadCount;<br/></span><span style="color: #008080;">573</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[] bufferInfo </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[count];<br/></span><span style="color: #008080;">574</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> filePath </span><span style="color: #000000;">=</span><span style="color: #000000;"> Path.Combine(path, fileName), pointFilePath </span><span style="color: #000000;">=</span><span style="color: #000000;"> <br/> Path.ChangeExtension(filePath, PointExtension), tempFilePath </span><span style="color: #000000;">=</span><span style="color: #000000;"><br/> Path.ChangeExtension(filePath, TempExtension);<br/></span><span style="color: #008080;">575</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FileStream pointStream;<br/></span><span style="color: #008080;">576</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> oddSize, avgSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> Math.DivRem(fileLength, <br/> (</span><span style="color: #0000ff;">long</span><span style="color: #000000;">)threadCount, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> oddSize);<br/></span><span style="color: #008080;">577</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (File.Exists(pointFilePath) </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> File.Exists(tempFilePath))<br/></span><span style="color: #008080;">578</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">579</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(pointFilePath, <br/> FileMode.Open, FileAccess.ReadWrite, FileShare.None);<br/></span><span style="color: #008080;">580</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream.Read(bufferInfo, </span><span style="color: #800080;">0</span><span style="color: #000000;">, count);<br/></span><span style="color: #008080;">581</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> w, t;<br/></span><span style="color: #008080;">582</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">583</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">584</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Read(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> w, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount);<br/></span><span style="color: #008080;">585</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Read(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> t, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">+</span><span style="color: #000000;"> PerLongCount);<br/></span><span style="color: #008080;">586</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].Initialize(tempFilePath, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> avgSize,<br/> &nbsp;i </span><span style="color: #000000;">==</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> avgSize </span><span style="color: #000000;">+</span><span style="color: #000000;"> oddSize : avgSize, w, t);<br/></span><span style="color: #008080;">587</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">588</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Breakpoint, i </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> read:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> w </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> t </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">589</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">590</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">591</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worker.Client.Send(bufferInfo);<br/></span><span style="color: #008080;">592</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">593</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br/></span><span style="color: #008080;">594</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">595</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(pointFilePath, FileMode.CreateNew, <br/> FileAccess.ReadWrite, FileShare.None);<br/></span><span style="color: #008080;">596</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FileStream stream </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(tempFilePath, FileMode.CreateNew, <br/> FileAccess.Write, FileShare.Write);<br/></span><span style="color: #008080;">597</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stream.SetLength(fileLength);<br/></span><span style="color: #008080;">598</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stream.Flush();<br/></span><span style="color: #008080;">599</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stream.Dispose();<br/></span><span style="color: #008080;">600</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">601</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">602</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].Initialize(tempFilePath, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> avgSize, i </span><span style="color: #000000;">==</span><span style="color: #000000;"> <br/> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> avgSize </span><span style="color: #000000;">+</span><span style="color: #000000;"> oddSize : avgSize);<br/></span><span style="color: #008080;">603</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">604</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;worker.Client.Send(bufferInfo, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #800080;">4</span><span style="color: #000000;">, SocketFlags.None);<br/></span><span style="color: #008080;">605</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">606</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer timer </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Timer(state </span><span style="color: #000000;">=&gt;</span><span style="color: #000000;"><br/></span><span style="color: #008080;">607</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">608</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> w, t;<br/></span><span style="color: #008080;">609</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">610</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">611</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].ReportProgress(</span><span style="color: #0000ff;">out</span><span style="color: #000000;"> w, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> t);<br/></span><span style="color: #008080;">612</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write(w, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount);<br/></span><span style="color: #008080;">613</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write(t, bufferInfo, i </span><span style="color: #000000;">*</span><span style="color: #000000;"> perPairCount </span><span style="color: #000000;">+</span><span style="color: #000000;"> PerLongCount);<br/></span><span style="color: #008080;">614</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#if</span><span style="color: #000000;"> BreakpointLog</span><span style="color: #000000;"><br/></span><span style="color: #008080;">615</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AppendTransmitLog(LogType.Breakpoint, i </span><span style="color: #000000;">+</span><span style="color: #000000;"><br/> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> write:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> w </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> t </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">616</span> <span style="color: #000000;"></span><span style="color: #0000ff;">#endif</span><span style="color: #000000;"><br/></span><span style="color: #008080;">617</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">618</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream.Position </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0L</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">619</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream.Write(bufferInfo, </span><span style="color: #800080;">0</span><span style="color: #000000;">, count);<br/></span><span style="color: #008080;">620</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream.Flush();<br/></span><span style="color: #008080;">621</span> <span style="color: #000000;"><br/></span><span style="color: #008080;">622</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, </span><span style="color: #0000ff;">null</span><span style="color: #000000;">, TimeSpan.Zero, TimeSpan.FromSeconds(</span><span style="color: #800080;">2</span><span style="color: #000000;">));<br/></span><span style="color: #008080;">623</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">624</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AutoResetEvent reset </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> AutoResetEvent(</span><span style="color: #0000ff;">true</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">625</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> threadCount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br/></span><span style="color: #008080;">626</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">627</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;workers[i].RunWork(i </span><span style="color: #000000;">==</span><span style="color: #000000;"> threadCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">?</span><span style="color: #000000;"> reset : </span><span style="color: #0000ff;">null</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">628</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">629</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reset.WaitOne();<br/></span><span style="color: #008080;">630</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#region</span><span style="color: #000000;"> Breakpoint</span><span style="color: #000000;"><br/></span><span style="color: #008080;">631</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> speed;<br/></span><span style="color: #008080;">632</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;"> value </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0L</span><span style="color: #000000;">;<br/></span><span style="color: #008080;">633</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">do</span><span style="color: #000000;"><br/></span><span style="color: #008080;">634</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/></span><span style="color: #008080;">635</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speed </span><span style="color: #000000;">=</span><span style="color: #000000;"> workers.ReportSpeed(</span><span style="color: #0000ff;">ref</span><span style="color: #000000;"> value);<br/></span><span style="color: #008080;">636</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">waiting for other threads. Progress:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"><br/> value </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">;Speed:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> speed </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kb/s.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">637</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span style="color: #800080;">1000</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">638</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">639</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">workers.IsAllFinished());<br/></span><span style="color: #008080;">640</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speed </span><span style="color: #000000;">=</span><span style="color: #000000;"> workers.ReportSpeed(</span><span style="color: #0000ff;">ref</span><span style="color: #000000;"> value);<br/></span><span style="color: #008080;">641</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">waiting for other threads. Progress:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> value </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">/</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> fileLength </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">;Speed:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> speed </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kb/s.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">642</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timer.Dispose();<br/></span><span style="color: #008080;">643</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointStream.Dispose();<br/></span><span style="color: #008080;">644</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File.Delete(pointFilePath);<br/></span><span style="color: #008080;">645</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File.Move(tempFilePath, filePath);<br/></span><span style="color: #008080;">646</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">647</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watcher.Stop();<br/></span><span style="color: #008080;">648</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Receive finish.Span Time:</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> <br/> watcher.Elapsed.TotalMilliseconds </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;"> ms.</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br/></span><span style="color: #008080;">649</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;}<br/></span><span style="color: #008080;">650</span> <span style="color: #000000;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;"><br/></span><span style="color: #008080;">651</span> <span style="color: #000000;"> &nbsp; &nbsp;}<br/></span><span style="color: #008080;">652</span> <span style="color: #000000;">}</span></p></pre><p><span class="cnblogs_code_copy"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"/></span></p><p>&nbsp;</p><p>PS：<br/>&nbsp;&nbsp;1、通过测试发现多线程stream.Flush()的地方会阻塞，</p><p>可以尝试增大stream的缓冲区或手动管理调用stream的Flush()。<br/>&nbsp;&nbsp;2、断点测试方法：先打开Server端，然后打开Client端发送；</p><p>中途任意关闭一端，再重复前一步即可。 <br/></p>
                                    </td>
                                </tr>
                            </table>
							
							
							
                            <table class="tb_title" style="margin: 5px auto 5px auto;">
                                <tr>
                                    <td class="tdright" id="bottomoption">
                                        <a href="/ac/tx/xuyuanqiang/">复制链接</a> <a href="/ac/tx/xuyuanqiang/">网友评论</a> <a href="#" onclick="addCookie('C# socket 多线程多管道可断点传送大文件_夜鹰教程网欢迎您!','http://www.yyjcw.com');return false;">
                                            收藏本文</a> <a href="###" onclick="window.close()">关闭此页</a>
                                    </td>
                                </tr>
                            </table>
                            <table class="tb_title" style="margin: 5px auto 5px auto;">
                                <tr>
                                    <td class="td_brief tdcenter" style="width: 100%;">
                                        上一条： <a href="/html/News/1688.html">C# Task 任务计划</a>&nbsp;&nbsp;下一条： <a href="/html/News/1675.html">让ListBox的滚动条滚动到最底部</a>
                                    </td>
                                </tr>
                            </table>
							<table class="tb_title">
                                <tr>
                                    <td class="td_brief" style="border: solid 1px #ccc; width: 100%;">
                                        
                                        <a href="http://www.yyjcw.com/list.html">购买夜鹰教程网视频教程</a>
                                    </td>
                                </tr>
                            </table>
							<table class="tb_title">
                                <tr>
                                    <td class="td_brief" style="border: solid 1px #ccc; width: 100%;">
                                   <ul style="width:100%; clear:both;" id="RelationList"><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1860.html" title="模拟登录人人网" >模拟登录人人网</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1859.html" title="HttpWebRequest以及HttpWebResponse介绍" >HttpWebRequest以及HttpWebRe…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1852.html" title="HttpClient使用说明" >HttpClient使用说明</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1831.html" title="Winform为Combobox树添加数据" >Winform为Combobox树添加数据…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1798.html" title="C#之允许DataGridView选中整行" >C#之允许DataGridView选中整行…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1797.html" title="C#中DataGridView只能选择一行禁止选择多行" >C#中DataGridView只能选择一行…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1795.html" title="为自动填充列调整大小期间不能执行此操作" >为自动填充列调整大小期间不能…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1794.html" title="c# winform设置listBox如何设置text和value" >c# winform设置listBox如何设…</a></li><li><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1697.html" title="c#的委托（代理）和事件 " >c#的委托（代理）和事件 </a></li></ul>
                                    </td>
                                </tr>
                            </table>
							
                        </td>
                        <td align="center" valign="top" class="tdboder_ccc" id="nei_content_right">
							 <table cellspacing="0" cellpadding="0" class="nei_rightList">
                                <tr>
                                    <td align="left" valign="middle" class="c_title">
                                        &nbsp;<img src="/images/nei_title.gif" alt="" />&nbsp;<a href="/list.html">热门服务</a>/<a href="/mulu.html">教程目录</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nei_Right_Content">
                                    <br/>
                                    <div style="line-height:24px;">&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a title="购买全套asp.net(c#)视频教程" target="_blank" href="/html/News/AboutUs_8.html">&nbsp;新手必看，详细又全面。</a><br />
&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a target="_blank" href="/tuangou.html">&nbsp;购买教程</a>&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a title="购买全套asp.net(c#)视频教程" target="_blank" href="/list.html">&nbsp;在线支付-方便</a><br />
&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a title="购买全套asp.net(c#)视频教程" target="_blank" href="/list.html">&nbsp;担保交易-快捷安全</a> &nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a title="购买全套asp.net(c#)视频教程" target="_blank" href="/tuangou.html">&nbsp;闪电发货</a><br />
&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;<a title="购买全套asp.net(c#)视频教程" target="_blank" href="/tuangou.html">&nbsp;电话和QQ随时可以联系我们。</a><br/>&nbsp;&nbsp;<img alt="夜鹰教程网" align="absMiddle" src="/images/arr11.gif" />&nbsp;不会的功能都可以找我们，按工作量收费。<br />
</div>
<div style="BORDER-BOTTOM: green 1px solid; TEXT-ALIGN: center; BORDER-LEFT: green 1px solid; MARGIN: 10px auto 0px; WIDTH: 236px; BORDER-TOP: green 1px solid; BORDER-RIGHT: green 1px solid">
<h3 style="FONT-SIZE: 18px">客服电话：153 9760 0032</h3>
购买教程QQ：1416759661&nbsp;&nbsp;<a style="DISPLAY: inline" onclick="var tempSrc='http://sighttp.qq.com/wpa.js?rantime='+Math.random()+'&amp;sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d';var oldscript=document.getElementById('testJs');var newscript=document.createElement('script');newscript.setAttribute('type','text/javascript'); newscript.setAttribute('id', 'testJs');newscript.setAttribute('src',tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;" target="_blank" href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d"><img border="0" alt="购买教程" src="http://wpa.qq.com/pa?p=1:1416759661:10" /></a>
</div>
                                    </td>
                                </tr>
                            </table>
                            <table cellspacing="0" cellpadding="0" class="nei_rightList">
                                <tr>
                                    <td align="left" valign="middle" class="c_title">
                                        &nbsp;<img src="/images/nei_title.gif" alt="" />&nbsp;<a href="/html/News/NewsList_2_1.html">热点推荐</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nei_Right_Content">
                                        <table style="margin: 5px 0 5px 0"><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1164.html" title="破解封路由的方法详解">破解封路由的方法详解</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1235.html" title="技巧篇：只用这一招就能拒绝全部的病毒木马">技巧篇：只用这一招就能拒绝全部的…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/281.html" title="挂马方法和技巧大汇总">挂马方法和技巧大汇总</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/521.html" title="网络安全防护:如何防止远程入侵">网络安全防护:如何防止远程入侵</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1121.html" title="如何解决：系统开机就弹出广告网页">如何解决：系统开机就弹出广告网页…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1125.html" title="彻底防御U盘病毒">彻底防御U盘病毒</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/284.html" title="安全配置交换机端口提高网络安全性">安全配置交换机端口提高网络安全性…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/589.html" title="浅析网络安全审计原理和技术(2)">浅析网络安全审计原理和技术(2)</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1120.html" title="用U盘就可以去除win&nbsp;XP管理员密码">用U盘就可以去除win XP管理员密码…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1258.html" title="电脑硬盘各逻辑盘用鼠标左键双击它无法打开">电脑硬盘各逻辑盘用鼠标左键双击它…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/282.html" title="详解网站挂马的手段">详解网站挂马的手段</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/287.html" title="新手认识;网银账号相关知识">新手认识;网银账号相关知识</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/280.html" title="ARP欺骗和ICMP欺骗催生全新DOS工具">ARP欺骗和ICMP欺骗催生全新DOS工具…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/588.html" title="浅析网络安全审计原理和技术(1)">浅析网络安全审计原理和技术(1)</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/279.html" title="木马最基本的隐藏:不可见窗体和隐藏文件">木马最基本的隐藏:不可见窗体和隐…</a></td></tr></table>
                                    </td>
                                </tr>
                            </table>
							
                              <table cellspacing="0" cellpadding="0" class="nei_rightList">
                                <tr>
                                    <td align="left" valign="middle" class="c_title">
                                        &nbsp;<img src="/images/nei_title.gif" alt="" />&nbsp;<a href="/ac/vip/">尊贵服务</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nei_Right_Content">
                                        <a href="/ac/vip/" style=" margin-left:5px; margin-top:5px; float:left;"><img src="/images/zq.jpg" alt="夜鹰教程网 承接业务：软件开发 网站开发 网页设计 .Net+C#+VS2008+MSsql+Jquery+ExtJs" style="width:258px; border:0;" /></a><a href="/tuangou.html" style="display:block;clear:both; line-height:24px; font-family:微软雅黑; text-align:center; ">夜鹰教程祝福大家新年快乐</a>
                                    </td>
                                </tr>
                            </table>
                            <table cellspacing="0" cellpadding="0" class="nei_rightList">
                                <tr>
                                    <td align="left" valign="middle" class="c_title">
                                        &nbsp;<img src="/images/nei_title.gif" alt="" />&nbsp;<a href="/news/NewsList.aspx?ClassID=24" title="最便宜的网站建设_视频教程_FLASH__ASP_ASP.NET_SQL2000_SQL2005_AJAX_FLEX_3ds max_Photoshop cs4_夜鹰教程网_www.yyjcw.com">最近更新</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nei_Right_Content">
                                        <table style="margin: 5px 0 5px 0"><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1860.html" title="模拟登录人人网" >模拟登录人人网</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1859.html" title="HttpWebRequest以及HttpWebResponse介绍" >HttpWebRequest以及HttpWebRespon…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1852.html" title="HttpClient使用说明" >HttpClient使用说明</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1831.html" title="Winform为Combobox树添加数据" >Winform为Combobox树添加数据</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1798.html" title="C#之允许DataGridView选中整行" >C#之允许DataGridView选中整行</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1797.html" title="C#中DataGridView只能选择一行禁止选择多行" >C#中DataGridView只能选择一行禁止…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1795.html" title="为自动填充列调整大小期间不能执行此操作" >为自动填充列调整大小期间不能执行…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1794.html" title="c#&nbsp;winform设置listBox如何设置text和value" >c# winform设置listBox如何设置te…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1697.html" title="c#的委托（代理）和事件&nbsp;" >c#的委托（代理）和事件 </a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1688.html" title="C#&nbsp;Task&nbsp;任务计划" >C# Task 任务计划</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1687.html" title="C#&nbsp;socket&nbsp;多线程多管道可断点传送大文件" >C# socket 多线程多管道可断点传送…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1675.html" title="让ListBox的滚动条滚动到最底部" >让ListBox的滚动条滚动到最底部</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1671.html" title="c#用事件模式实现通知" >c#用事件模式实现通知</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1667.html" title="&nbsp;什么是异步编程，为什么会需要异步编程" > 什么是异步编程，为什么会需要异…</a></td></tr><tr><td style="line-height: 24px;"><img src="/images/arrow2.gif" alt="" style="margin-left: 3px;" /><a href="/html/News/1660.html" title="c#开发电影售票系统" >c#开发电影售票系统</a></td></tr></table>
                                    </td>
                                </tr>
                            </table>
                            <table cellspacing="0" cellpadding="0" class="nei_rightList">
                                <tr>
                                    <td align="left" valign="middle" class="c_title">
                                        &nbsp;<img src="/images/nei_title.gif" alt="" />&nbsp;<a href="/aboutus/AboutUs.aspx?id=10" title="最便宜的网站建设_视频教程_FLASH__ASP_ASP.NET_SQL2000_SQL2005_AJAX_FLEX_3ds max_Photoshop cs4_夜鹰教程网_www.yyjcw.com">工具下载</a>&nbsp;&nbsp;需要远程协助?&nbsp;<a style="DISPLAY: inline" onclick="var tempSrc='http://sighttp.qq.com/wpa.js?rantime='+Math.random()+'&amp;sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d';var oldscript=document.getElementById('testJs');var newscript=document.createElement('script');newscript.setAttribute('type','text/javascript'); newscript.setAttribute('id', 'testJs');newscript.setAttribute('src',tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;" target="_blank" href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d"><img border="0" alt="购买教程" src="http://wpa.qq.com/pa?p=1:1416759661:10" /></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nei_Right_Content ">
                                    <div style=" margin-top:3px; margin-left:3px; ">
                                      <p><a target="_blank" href="http://www.yyjcw.com/html/News/1461.html"><span style="color:#0000ff;font-size:12px"><strong>sql2008视频教程</strong></span></a>&nbsp;<a target="_blank" href="http://www.yyjcw.com/list.html"><span style="color:#0000ff;font-size:12px"><strong>c#视频教程</strong></span></a><br/></p><h3>VIP服务：如果您的某个功能不会做，可以加我们QQ，给你做DEMO！</h3><h3><a target="_blank" href="http://www.yyjcw.com/tuangou.html" style="font-size: 16px;">JQUERY</a>&nbsp;<a target="_blank" href="http://www.yyjcw.com/tuangou.html" style="font-size: 16px;">中文排名第51888位</a><span style="font-size: 16px;"> </span><span style="font-size: 16px; color: rgb(0, 0, 255);"><a href="http://www.yyjcw.com/tuangou.html"><span style="font-size:12px"><strong>Asp.net教程</strong></span></a></span></h3><p><span style="color:#0000ff"><strong><span style="font-size:12px"><a href="http://www.yyjcw.com/html/News/1582.html">MVC视频教程</a>&nbsp;</span></strong></span> <a target="_blank" href="http://www.yyjcw.com/tuangou.html">vs2010<br/></a><strong><span style="color:#0000ff;font-size:12px"><a href="http://www.yyjcw.com/tuangou.html">.NET+sql开发、同行业最低价&nbsp; </a><a href="http://www.yyjcw.com/ac/lucky/">幸运大抽奖</a><br/></span></strong><span style="color:#0000ff">手机：15397600032 </span><a target="_blank" href="http://www.yyjcw.com/tuangou.html"><span style="color:#0000ff">C#视频教程下载</span></a><br/><a target="_blank" href="http://www.yyjcw.com/tuangou.html">vs2012</a> <a target="_blank" href="http://www.yyjcw.com/html/News/AboutUs_3.html">vs2008</a> <a target="_blank" href="http://www.yyjcw.com/tuangou.html">vs2010</a> <a target="_blank" href="http://www.yyjcw.com/tuangou.html">sql2008</a>&nbsp;<a target="_blank" href="http://www.yyjcw.com/tuangou.html">sql2005</a><br/><a target="_blank" href="http://www.yyjcw.com/tuangou.html">Asp.Net <span style="color:#ff0000;font-size:16px"><strong>购买</strong></span> <br/></a><a style="COLOR: red; FONT-SIZE: 14px" target="_blank" href="http://www.yyjcw.com/ting.html">视频教程试听</a>购买教程QQ:1416759661</p><p><br/></p>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
</table>
<div class="outcontainer" style="border: solid 1px white;border-left:0;border-right: 0;">
<div class="incontainner indexnews">
<div style="margin: 10px;">
<p><img src="/images/2Code.jpg" style="float:right;"/></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">计算机技术辅导。</span></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">QQ：1416759661 &nbsp; 新手求救QQ群：7835003</span></p><p><span style="color: rgb(192, 80, 77); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果您遇到技术难题，</span><span style="color: rgb(192, 80, 77); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">需要远程调试都可以加我们QQ</span></p><p>技术咨询： <a target="_blank" href="http://www.taobao.com/webww/ww.php?ver=3&touid=%E5%A4%9C%E9%B9%B0%E9%97%AA%E5%AE%A2%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B%E7%BD%91&siteid=cntaobao&status=1&charset=utf-8"><img border="0" src="http://amos.alicdn.com/realonline.aw?v=2&uid=%E5%A4%9C%E9%B9%B0%E9%97%AA%E5%AE%A2%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B%E7%BD%91&site=cntaobao&s=1&charset=utf-8" alt="购买教程"/></a>
 &nbsp;技术咨询：<a href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d" target="_blank" onclick="var tempSrc=&#39;http://sighttp.qq.com/wpa.js?rantime=&#39;+Math.random()+&#39;&amp;sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d&#39;;var oldscript=document.getElementById(&#39;testJs&#39;);var newscript=document.createElement(&#39;script&#39;);newscript.setAttribute(&#39;type&#39;,&#39;text/javascript&#39;); newscript.setAttribute(&#39;id&#39;, &#39;testJs&#39;);newscript.setAttribute(&#39;src&#39;,tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;"><img border="0" src="http://wpa.qq.com/pa?p=1:1416759661:10" alt="购买教程"/></a></p>
</div>
<div style="clear: both;"></div>
</div>
</div>

<div class="outcontainer" style="border: solid 1px white;border-left:0;border-right: 0;">
<div class="incontainner indexnews bottom">
<p><a href="/html/News/AboutUs_1.html" title="夜鹰教程网">关于我们</a> | <a href="/html/News/AboutUs_2.html" title="夜鹰教程网">广告投放</a> | <a href="/html/News/AboutUs_3.html" title="夜鹰教程网">购买教程</a> | <a href="/html/News/AboutUs_4.html" title="夜鹰教程网">网站建设</a> | <a href="/html/News/AboutUs_5.html" title="夜鹰教程网">技术辅导</a> | <a href="/html/News/AboutUs_8.html" title="夜鹰教程网">常见问题</a> | <a href="/html/News/AboutUs_6.html" title="夜鹰教程网">联系我们</a> | <a href="/html/News/AboutUs_7.html">友情链接</a> | <a href="http://sighttp.qq.com/cgi-bin/check?sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d"; target="_blank" onclick="var tempSrc='http://sighttp.qq.com/wpa.js?rantime='+Math.random()+'&sigkey=05a95cdf3fa1602e580171226ada682ed2d4a1cb451bf047f1e4969e5fc7b62d';var oldscript=document.getElementById('testJs');var newscript=document.createElement('script');newscript.setAttribute('type','text/javascript'); newscript.setAttribute('id', 'testJs');newscript.setAttribute('src',tempSrc);if(oldscript == null){document.body.appendChild(newscript);}else{oldscript.parentNode.replaceChild(newscript, oldscript);}return false;"><img border="0" SRC='http://wpa.qq.com/pa?p=1:1416759661:10' alt="购买教程"></a>
<p><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_951426'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/stat.php%3Fid%3D951426%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>Nighthawk Tutorials Network <a href="/list.html">快捷购买教程</a></p>
<p><a href="http://www.yyjcw.com" style="color:#801326;">夜鹰教程网</a> 版权所有 <a href="http://www.yyjcw.com" style="color:#801326;">www.yyjcw.com</a> All rights reserved 备案号：<a href="http://www.miibeian.gov.cn/" style="color:#801326;" target="_blank">蜀ICP备08011740号3</a></p>
                            <p>&nbsp;</p>
</div>
</div>                           

    
    </form>

    <script type="text/javascript">
        function AutoScroll(obj) {
            $(obj).find("ul:first").animate({
                marginTop: "-24px"
            }, 500, function() {
                $(this).css({ marginTop: "0px" }).find("li:first").appendTo(this);
            });
        }
        
        $(function() {
            var sliding=setInterval('AutoScroll(".topNotice")', 5000);
            $(".topNotice").hover(function() {
                clearInterval(sliding);
            }, function() {
                sliding = setInterval('AutoScroll(".topNotice")', 5000);
            });        
        })     

        
        
        //更新浏览次数
        UpdateVisitCount();
        function UpdateVisitCount() {

            $.post("/common/ajax/ajax.aspx?" + Math.random(), { w: "UpdateVisitCount", _id: "1687" }, function(data) {

            })
        }
        t();
    </script>
	

 <div style="background-color:Black; width:100%; height:30px;position:fixed;left:0;bottom:0;filter:alpha(opacity=80); z-index:100; text-align:center; color:White; font-size:14px; font-weight:bolder; line-height:30px;"> <a href="http://www.yyjcw.com/list.html" style="color:White;">出售</a><a href="http://www.yyjcw.com/list.html" style="color:White;">asp.net系列视频教程</a> <a href="http://www.yyjcw.com/list.html" style="color:White;">高清原创版</a>
每天晚上20：30--23：00在线
<a href="http://www.yyjcw.com/list.html" style="color:White;">按照编号从简单到高级</a>
<a href="http://www.yyjcw.com/list.html" style="color:White;">http://www.yyjcw.com/list.html</a> </div>
</body>
</html>

